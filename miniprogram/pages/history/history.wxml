<!--pages/history/history.wxml-->
<view class="history-page">
  <!-- 顶部标题 -->
  <view class="page-header">
    <view class="header-title">历史记录</view>
    <view class="header-subtitle text-muted">保留最近30天的生成记录</view>
  </view>

  <!-- 历史列表 -->
  <view class="history-list" wx:if="{{historyList.length > 0}}">
    <view class="history-item animate-fadeIn" 
          wx:for="{{historyList}}" 
          wx:key="job_id"
          style="animation-delay: {{index * 0.05}}s"
          bindtap="onItemClick"
          data-item="{{item}}">
      
      <view class="item-image">
        <image class="thumbnail" 
               src="{{item.thumbnail_url}}" 
               mode="aspectFill"
               lazy-load="true"></image>
        <view class="status-badge {{item.status}}">
          <text wx:if="{{item.status === 'succeeded'}}">已完成</text>
          <text wx:elif="{{item.status === 'generating'}}">生成中</text>
          <text wx:elif="{{item.status === 'failed'}}">失败</text>
          <text wx:else>{{item.status}}</text>
        </view>
      </view>

      <view class="item-content">
        <view class="item-title">宝宝照生成</view>
        <view class="item-meta">
          <view class="meta-item">
            <image src="/images/icons/clock.png" mode="aspectFit"></image>
            <text>{{item.created_time}}</text>
          </view>
          <view class="meta-item" wx:if="{{item.original_access === 'included' || item.original_access === 'unlocked'}}">
            <image src="/images/icons/hd.png" mode="aspectFit"></image>
            <text>原图已解锁</text>
          </view>
        </view>
      </view>

      <view class="item-arrow">
        <image src="/images/icons/arrow-right.png" mode="aspectFit"></image>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="skeleton-item" wx:for="{{3}}" wx:key="*this">
      <view class="skeleton skeleton-image"></view>
      <view class="skeleton-content">
        <view class="skeleton skeleton-title"></view>
        <view class="skeleton skeleton-meta"></view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && historyList.length === 0}}">
    <view class="empty-icon-wrapper">
      <image class="empty-icon" src="/images/icons/empty-history.png" mode="aspectFit"></image>
    </view>
    <view class="empty-title">暂无生成记录</view>
    <view class="empty-desc text-muted">快去生成你的第一张宝宝照吧</view>
    <button class="btn btn-primary" bindtap="onGoGenerate">
      立即生成
    </button>
  </view>

  <!-- 底部提示 -->
  <view class="footer-tips" wx:if="{{historyList.length > 0}}">
    <text class="text-muted font-sm">记录将在30天后自动清理</text>
  </view>
</view>
